<html>
    <head>
        <title>
            <%= title %>
        </title>
    </head>

    <body>

        <section id="feed-posts">
            <h4>
                Posts
            </h4>

            <% if(locals.user) {%>
            <form action="\posts\create" id="new-post form" method="POST">
                <textarea name="content" id="" cols="30" rows="3" placeholder="Type here.." required></textarea>
                <input type="submit" value="Post">
            </form>
        <%}%>
        </section>
       
        <div>
            <ul>
                <% for(let post of posts){ %>
                    <li>
                        <p>
                            <%if(locals.user&&locals.user.id==post.user.id){%>
                            <small>
                                <a href="/posts/destroy/<%=post.id%>">Delete Post</a>
                            </small>
                        <%}%>
                            <h3>
                                <%= post.content %>
                            </h3>
                            
                                -<%= post.user.name%>
                        </p>

                        <div class="post-comments">
                            <% if(locals.user){%>
                                <form action="/comments/create" method="POST">
                                    <input type="text" name="content" placeholder="add comment..." required>
                                    <input type="hidden" name="post" value="<%= post._id%>">
                                    <input type="submit" value="Comment">
                                </form>
                            <%}%>

                            <div class="post-comments-list">
                                <ul id="post-comments-<%= post._id %>">
                                    <% for (comment of post.comments) {%>
                                        <p>
                                            <%=comment.content%>
                                            <br>
                                            <small>
                                                -<%= comment.user.name%>
                                            </small>
                                        </p>
                                        <%}%>
                                </ul>
                            </div>
                        </div>
                    </li>
                    
                <% } %>
            </ul>
        </div>

    </body>
</html>
